# -*- coding: utf-8 -*-
"""3102

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1IXEm1zNLnixFUsxJcRUzAh3udYYfk8kb
"""

import anvil.server # import Anvil server lib
anvil.server.connect("AUNCATU3SXUIECPC3KKECHWE-LSGS34RAIS5QGAFE") # Connection uplink to Anvil Front End
from urllib.parse import urljoin
import requests


#################################################################
######################### QandA Modules #########################
#################################################################
@anvil.server.callable
def QandA_Generated(image):
    # image argument should be the image object pass from the user
    # This function should then call the other function for Caption, Ques and Ans
    # Caption Function call
    Cap = Caption_Function()
    # Answer Function call
    Result = QnA_Function()
    Ans = Result[1]
    Ques = Result[0]
    
    # This should return the Caption, Question and Answer
    QA_Generated = ['Hello from Caption', Ans, Ques] # test code excutable
    return(QA_Generated)

@anvil.server.callable
def Caption_Function():
    # Code
    return 0 # Return text(str) for caption of image


@anvil.server.callable
def QnA_Function():
    caption = 'The herb is generally safe to use. There is limited research to suggest that stinging nettle is an effective remedy. Researchers need to do more studies before they can confirm the health benefits of stinging nettle.'
    URL = urljoin('http://Transformer:8888/transformer/', caption)
    # sending get request and saving the response as response object
    QnA_Response = requests.get(url = URL)
    # extracting data in json format
    data = QnA_Response.json()
    for i in data:
        Question = f"{i['question']}"
        Answer = f"{i['answer']}"
        Q = Question
        A = Answer
    return [Q, A] # Return text(str) for Answer for image



#################################################################
########################## DB Modules ###########################
#################################################################
@anvil.server.callable
def Call_All_DB():
    # Code
    return 0 # returns all the items in DB

@anvil.server.callable
def Search_DB():
    # Code
    return 0 # returns a specific DB item

@anvil.server.callable
def Update_DB():
    # Code
    return 0 # Updates a item in the DB

@anvil.server.callable
def Delete_DB():
    # Code
    return 0 # Deletes a item in DB

@anvil.server.callable
def Add_DB(Caption, Answer, Question, image):
    # Function to save all 4 args into DB
    # Code
    return ("Saved: ", Caption, Answer, Question, " Image: ", image) # test code excutable


#################################################################
###### Set this sever to wait forever like a restful API ########
#################################################################
anvil.server.wait_forever()

# Simple Check code of available lib in environment
# !pip freeze